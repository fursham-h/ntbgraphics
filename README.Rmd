---
title: "ReadMe for ntbgraphics"
output:
  rmarkdown::github_document
---

This package includes functions for importing, transforming and visualization of NTB datasets:

  - '*getexpdata*' for import of the Animal List (containing animal RFIDs, corresponding Genotypes and optionally Environment) and Meta Behavior (containing animals and their behavioral measures) as well as formal preparation;
  - '*ploteachexp*' for plotting of given experiments as boxplots and exporting the result as a PDF file;
  - '*loopplotexp*' for plotting all experiments within a dataset as boxplots and exporting the results in one PDF file;
  - '*heatmapexp*' for plotting all experiments as a heatmap and producing a datamatrix with z-scored values.
  
All functions take a **directory** as their input, which specifies the location of the **two files** "Animal List" and "Meta Behavior" (mind correct spelling of these files - functions rely on specific names!). 
It is also important that you mind correct **formatting** of your excel files. This includes:

  - at least three columns with information about 'RFID', 'Genotype' and 'Environmental' [Condition] in your Animal List with these exact titles;
  - at least three columns with information about 'Animal', 'Meanspeed'	and	'SerialLearn' in your Meta Behavior with these exact titles;
  - correct order of columns: 
    - the Animal List does not require a certain order;
    - the Meta Behavior should list 'Meanspeed' as the very first and 'SerialLearn' as the very last of all behavioral experiments (only columns inbetween including the former will be considered for behavioral analysis) -- 'Animal' might be at the very beginning or end, but not inbetween!
\   

Furthermore, each function requires definition of the experimental setup in terms of 4-arm or 2-arm design, respectively required type of analysis (you may want to analyze your 4-arm experiment as 2-arm, only looking at two conditions). The default setup assumes a 4-arm experiment. Further aspects can be customized depending on the specific function.

All functions externally work on their own, which means that they may rely internally on one of the other functions of the package without the user needing to run them in advance.  
\
\
\   

The following plot shows the general layout you can expect from the boxplot functions ('ploteachexp' and 'loopplotexp').
\   

``` {r echo=FALSE, message=FALSE, warning=FALSE}

library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggsignif)

meta.data = read_excel("/Users/paul/Documents/Github_Repo/ntbgraphics/inst/extdata/Meta Behavior.xlsx")
animal.list = read_excel("/Users/paul/Documents/Github_Repo/ntbgraphics/inst/extdata/Animal List.xlsx")

data.animal.joined = animal.list %>%
  filter(Genotype!= 'NA') %>%
  unite(col="GT_Env", Genotype, Environmental, sep= "_", remove = FALSE) %>%
  left_join(meta.data, by = c("RFID" = "Animal")) %>%
  dplyr::mutate_at(vars(Meanspeed:SerialLearn),(funs(as.numeric))) %>%
  select(RFID, GT_Env, Meanspeed:SerialLearn)

ymin = min(data.animal.joined$Meanspeed, na.rm = TRUE)*0.25
ymax = max(data.animal.joined$Meanspeed, na.rm = TRUE)*1.25

ggplot(data.animal.joined, aes_string(x="GT_Env", y="Meanspeed", fill="GT_Env")) +

  geom_boxplot(alpha = 0.4) +
  
  scale_fill_manual(values=c("#F7FCFD", "#CCECE6", "#238B45", "#00441B")) +
  scale_color_manual(values=c("#F7FCFD", "#CCECE6", "#238B45", "#00441B")) +

  geom_point(pch = 21, stroke=0.93, position = position_jitterdodge()) +

  ylab("MeanspeedScore") +
  xlab("Conditions") +

  coord_cartesian(ylim=c(ymin, ymax)) +

  geom_signif(test = "t.test",  
           comparisons = list(c(1, 2),
                              c(3, 4),
                              c(2, 3),
                              c(2, 4)), 
           y=c(0.85*ymax, 0.85*ymax, 0.89*ymax, 0.95*ymax), 
           map_signif_level = c("***"=0.001, "**"=0.01, "*"=0.05), 
           textsize = 5,  tip_length = 0.005) +

  ggtitle("Meanspeed") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(plot.title = element_text(size = 16)) +
  theme(panel.grid.major = element_blank(),
    panel.border = element_blank(),
    panel.grid.minor = element_blank(),
    legend.key = element_blank(),
    strip.background = element_blank(),
    
    axis.line.y = element_line(colour = "black", size=0.6),
    axis.ticks.x = element_blank(),
    axis.text.x = element_text(angle=0, size=10),
    axis.text.y = element_text(angle=0, size=10),
    text = element_text(size=14),
    
    legend.text = element_text(size=9),
    legend.title = element_text(size=12))
```
\
\
\   

The following map shows the general layout you can expect from the 'heatmapexp' function.
\   

``` {r echo=FALSE, message=FALSE, warning=FALSE}

library(ntbgraphics)

a <- heatmapexp(directory = paste0(system.file("extdata", package = "ntbgraphics",
                                                                mustWork = T),"/"),
                                 analysis = "4arm",
                                 title = "Example Data Heatmap")
```
